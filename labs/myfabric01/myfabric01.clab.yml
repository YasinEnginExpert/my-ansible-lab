name: myfabric01
# prefix: "__lab-name"   # İstersen container isimleri myfabric01-spine1 gibi olur.
# (Değiştirirsen ansible inventory node isimleri de değişebilir.)

mgmt:
  network: fixedips
  ipv4-subnet: 172.200.20.0/24

topology:
  # 1) Tekrarlanan image/type satırlarını azaltmak için kinds
  kinds:
    nokia_srlinux:
      type: ixr-d2l
      image: ghcr.io/nokia/srlinux:${SRL_VERSION:=latest}
    linux:
      image: alpine:${ALPINE_VERSION:=3.20}
      # Linux container'ların ayakta kalması için (bazı image'larda şart)
      cmd: sh -c "sleep infinity"

  # 2) Gruplarla ortak label/özellikleri toplamak
  groups:
    spines:
      kind: nokia_srlinux
      labels:
        ansible-group: spine
        asn: "65000"
    leaves:
      kind: nokia_srlinux
      labels:
        ansible-group: leaf
    hosts:
      kind: linux
      labels:
        ansible-group: hosts

  nodes:
    # ================= SPINES (AS 65000) =================
    spine1:
      group: spines
      mgmt-ipv4: 172.200.20.11
      kind: nokia_srlinux
      labels:
        ansible-group: spine
        asn: "65000"

    spine2:
      group: spines
      mgmt-ipv4: 172.200.20.12

    # ================= LEAFS (her biri ayrı AS) =================
    leaf1:
      group: leaves
      mgmt-ipv4: 172.200.20.21
      labels:
        ansible-group: leaf
        asn: "65001"
      kind: nokia_srlinux

    leaf2:
      group: leaves
      mgmt-ipv4: 172.200.20.22
      labels:
        asn: "65002"

    leaf3:
      group: leaves
      mgmt-ipv4: 172.200.20.23
      labels:
        asn: "65003"

    # ================= SERVERS =================
    pc1:
      group: hosts
      mgmt-ipv4: 172.200.20.101
      labels:
        ansible-group: hosts
        vlan: "10"
      kind: linux

    pc2:
      group: hosts
      mgmt-ipv4: 172.200.20.102
      labels:
        ansible-group: hosts
        vlan: "20"
      kind: linux

    pc3:
      group: hosts
      mgmt-ipv4: 172.200.20.103
      labels:
        ansible-group: hosts
        vlan: "10"
      kind: linux

    pc4:
      group: hosts
      mgmt-ipv4: 172.200.20.104
      labels:
        ansible-group: hosts
        vlan: "20"
      kind: linux

    pc5:
      group: hosts
      mgmt-ipv4: 172.200.20.105
      labels:
        ansible-group: hosts
        vlan: "10"
      kind: linux

    pc6:
      group: hosts
      mgmt-ipv4: 172.200.20.106
      labels:
        ansible-group: hosts
        vlan: "20"
      kind: linux

  links:
    # ==========================================================
    # SPINE ↔ LEAF (L3 / eBGP underlay)
    # Interface ALIAS kullanıyoruz: ethernet-1/1 gibi (SRL config ile aynı dil)
    # Ayrıca SRL desteklediği için link üstünden IPv4 veriyoruz (/31 p2p).
    # ==========================================================

    # leaf1 uplinks
    - endpoints: [ "spine1:ethernet-1/1", "leaf1:ethernet-1/3" ]
      ipv4: [ "10.0.0.0/31", "10.0.0.1/31" ]
    - endpoints: [ "spine2:ethernet-1/1", "leaf1:ethernet-1/4" ]
      ipv4: [ "10.0.0.2/31", "10.0.0.3/31" ]

    # leaf2 uplinks
    - endpoints: [ "spine1:ethernet-1/2", "leaf2:ethernet-1/3" ]
      ipv4: [ "10.0.0.4/31", "10.0.0.5/31" ]
    - endpoints: [ "spine2:ethernet-1/2", "leaf2:ethernet-1/4" ]
      ipv4: [ "10.0.0.6/31", "10.0.0.7/31" ]

    # leaf3 uplinks
    - endpoints: [ "spine1:ethernet-1/3", "leaf3:ethernet-1/3" ]
      ipv4: [ "10.0.0.8/31", "10.0.0.9/31" ]
    - endpoints: [ "spine2:ethernet-1/3", "leaf3:ethernet-1/4" ]
      ipv4: [ "10.0.0.10/31", "10.0.0.11/31" ]

    # ==========================================================
    # LEAF ↔ PCs (L2 Access)
    # Burada IP vermiyoruz (linux tarafı için ayrı isteriz).
    # Ama vars ile VLAN bilgisini gömüyoruz -> ileride template/automation’da kullanırsın.
    # ==========================================================

    # leaf1 access ports
    - endpoints: [ "pc1:eth1", "leaf1:ethernet-1/1" ]
      vars: { vlan: 10, role: "access" }
    - endpoints: [ "pc2:eth1", "leaf1:ethernet-1/2" ]
      vars: { vlan: 20, role: "access" }

    # leaf2 access ports
    - endpoints: [ "pc3:eth1", "leaf2:ethernet-1/1" ]
      vars: { vlan: 10, role: "access" }
    - endpoints: [ "pc4:eth1", "leaf2:ethernet-1/2" ]
      vars: { vlan: 20, role: "access" }

    # leaf3 access ports
    - endpoints: [ "pc5:eth1", "leaf3:ethernet-1/1" ]
      vars: { vlan: 10, role: "access" }
    - endpoints: [ "pc6:eth1", "leaf3:ethernet-1/2" ]
      vars: { vlan: 20, role: "access" }
